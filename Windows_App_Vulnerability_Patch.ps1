Write-Output "Starting Script"

# Set to True to turn on 

$UpdateHEVC = "False"
$UpdateHEIF = "False"
$UpdateMPEG2 = "False"
$UpdateWebMedia = "False"
$UpdatePaint3D = "False"
$UpdatePhoto = "False"
$Update3DViewer = "False"
$UpdateVP9 = "False"
$UpdateAV1 = "False"
$UpdateCalculator = "False"

$HEVCFILE = "Microsoft.HEVCVideoExtension_2.0.51121.0_x64__8wekyb3d8bbwe.appx"
$HEIFFILE = "Microsoft.HEIFImageExtension_1.0.43012.0_x64__8wekyb3d8bbwe.appx"
$MPEG2FILE = "Microsoft.MPEG2VideoExtension_1.0.50901.0_x64__8wekyb3d8bbwe.Appx"
$WebMediaFILE = "Microsoft.HEVCVideoExtension_2.0.51121.0_x64__8wekyb3d8bbwe.appx"
$Paint3DFILE = "Microsoft.MSPaint_2022.2203.1037.0_neutral___8wekyb3d8bbwe.AppxBundle"
$PhotoFILE = "Microsoft.Windows.Photos_2022.30070.26007.0_neutral___8wekyb3d8bbwe.AppxBundle"
$3DViewerFILE = "Microsoft.Microsoft3DViewer_2021.2107.7012.0_neutral___8wekyb3d8bbwe.AppxBundle"
$VP9FILE = "Microsoft.VP9VideoExtensions_1.0.52781.0_x64__8wekyb3d8bbwe.Appx"
$AV1FILE = "Microsoft.AV1VideoExtension_1.1.52074.0_x64__8wekyb3d8bbwe.Appx"
$CalculatorFILE = "Microsoft.WindowsCalculator_2020.2103.8.0_neutral___8wekyb3d8bbwe.AppxBundle"
$UIXaml2FILE = "Microsoft.UI.Xaml.2.4_2.42007.9001.0_x64__8wekyb3d8bbwe.Appx"

$HEVCURL = "https://github.com/Kavex/WindowsStore/releases/download/2.0.51121.0/Microsoft.HEVCVideoExtension_2.0.51121.0_x64__8wekyb3d8bbwe.appx"
$HEIFURL = "https://github.com/Kavex/WindowsStore/releases/download/1.0.43012.0/Microsoft.HEIFImageExtension_1.0.43012.0_x64__8wekyb3d8bbwe.appx"
$MPEG2URL = "https://github.com/Kavex/WindowsStore/releases/download/1.0.50901.0/Microsoft.MPEG2VideoExtension_1.0.50901.0_x64__8wekyb3d8bbwe.Appx"
$WebMediaURL = "https://github.com/Kavex/WindowsStore/releases/download/untagged-27ef648a981d7b0723bc/Microsoft.WebMediaExtensions_1.0.42192.0_neutral_._8wekyb3d8bbwe.appxbundle"
$Paint3DURL = "https://github.com/Kavex/WindowsStore/releases/download/2022.2203.1037.0/Microsoft.MSPaint_2022.2203.1037.0_neutral___8wekyb3d8bbwe.AppxBundle"
$PhotoURL = "https://github.com/Kavex/WindowsStore/releases/download/2022.30070.26007.0/Microsoft.Windows.Photos_2022.30070.26007.0_neutral___8wekyb3d8bbwe.AppxBundle"
$3DViewerURL = "https://github.com/Kavex/WindowsStore/releases/download/2021.2107.7012.0/Microsoft.Microsoft3DViewer_2021.2107.7012.0_neutral___8wekyb3d8bbwe.AppxBundle"
$VP9URL = "https://github.com/Kavex/WindowsStoreApps/releases/download/MicrosoftVP9VideoExtensions/Microsoft.VP9VideoExtensions_1.0.52781.0_x64__8wekyb3d8bbwe.Appx"
$AV1URL = "https://github.com/Kavex/WindowsStore/releases/download/1.1.52074.0/Microsoft.AV1VideoExtension_1.1.52074.0_x64__8wekyb3d8bbwe.Appx"
$CalculatorURL = "https://github.com/Kavex/WindowsStoreApps/releases/download/2020.2103.8.0/Microsoft.WindowsCalculator_2020.2103.8.0_neutral___8wekyb3d8bbwe.AppxBundle"
$UIXaml2URL = "https://github.com/Kavex/WindowsStoreApps/releases/download/2020.2103.8.0/Microsoft.UI.Xaml.2.4_2.42007.9001.0_x64__8wekyb3d8bbwe.Appx"

$RunHEVC = $UpdateHEVC
$RunHEIF = $UpdateHEIF
$RunMPEG2 = $UpdateMPEG2
$RunWebMedia = $UpdateWebMedia
$RunPaint3D = $UpdatePaint3D
$RunPhoto = $UpdatePhoto
$Run3DViewer = $Update3DViewer
$RunVP9 = $UpdateVP9
$RunAV1 = $UpdateAV1
$RunCalculator = $UpdateCalculator

if ($RunHEVC -eq "True")
{
    $CurrentURL = $HEVCURL
    $CurrentFILE = $HEVCFILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($RunHEIF -eq "True")
{
    $CurrentURL = $HEIFURL
    $CurrentFILE = $HEIFFILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($RunMPEG2 -eq "True")
{
    $CurrentURL = $MPEG2URL
    $CurrentFILE = $MPEG2FILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($RunWebMedia -eq "True")
{
    $CurrentURL = $WebMediaURL
    $CurrentFILE = $WebMediaFILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($RunPaint3D -eq "True")
{
    $CurrentURL = $Paint3DURL
    $CurrentFILE = $Paint3DFILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($RunPhoto -eq "True")
{
    $CurrentURL = $PhotoURL
    $CurrentFILE = $PhotoFILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($Run3DViewer -eq "True")
{
    $CurrentURL = $3DViewerURL
    $CurrentFILE = $3DViewerFILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
  
}

if ($RunVP9 -eq "True")
{
    $CurrentURL = $VP9URL
    $CurrentFILE = $VP9FILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($RunAV1 -eq "True")
{
    $CurrentURL = $AV1URL
    $CurrentFILE = $AV1FILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

if ($RunCalculator -eq "True")
{
    $CurrentURL = $UIXaml2URL
    $CurrentFILE = $UIXaml2FILE 
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"

    $CurrentURL = $CalculatorURL
    $CurrentFILE = $CalculatorFILE
    Write-Output "Downloading $CurrentFILE"
    cd c:\temp\
    Invoke-WebRequest -Uri $CurrentURL -OutFile $CurrentFILE
    Write-Output "Installing $CurrentFILE"
    add-appxpackage -Path ".\$CurrentFILE"
}

Write-Output "Finishing up installing, Waiting 5 Mins"
Start-Sleep -Seconds 300
Write-Output "Deleteing Downloaded Files"
Remove-Item 'C:\Temp\*' -Recurse -Include *.AppxBundle
Remove-Item 'C:\Temp\*' -Recurse -Include *.Appx

Write-Output "Exporting List of installed Windows Apps"
Get-AppxPackage –AllUsers | Out-File "C:\temp\WindowsAppsInstalled.log" -Append -force